<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Discord Chat Analyzer</title>
    <meta name="description" content="Analyze your Discord chat exports locally in your browser. No data leaves your machine.">

    <!-- Open Graph / Discord Preview -->
    <meta property="og:type" content="website">
    <meta property="og:title" content="Discord Chat Analyzer">
    <meta property="og:description" content="Analyze your Discord chat exports locally in your browser.">
    <meta property="og:image" content="public/preview.png">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <div class="container">

        <!-- Header -->
        <div class="header">
            <div>
                <h1>Discord Chat Analyzer</h1>
                <span class="subtitle">Local-only analysis of DiscordChatExporter CSV files</span>
            </div>
            <div class="theme-toggle" id="theme-btn" onclick="toggleTheme()" title="Toggle Theme">
                <!-- icon injected by JS -->
            </div>
        </div>

        <!-- Upload -->
        <div id="upload-section" class="upload-area" onclick="document.getElementById('csv-upload').click()">
            <svg class="icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
                <path stroke-linecap="round" stroke-linejoin="round" d="M12 16V4m0 0l-4 4m4-4l4 4M4 18h16" />
            </svg>
            <h2 id="upload-title">Drop a .csv file here or click to browse</h2>
            <p class="desc" id="upload-desc">Exported from <a href="https://github.com/Tyrrrz/DiscordChatExporter" target="_blank" rel="noopener" style="color:var(--accent);text-decoration:none;" onclick="event.stopPropagation()">DiscordChatExporter</a></p>
            <label class="upload-btn" onclick="event.stopPropagation()">
                Choose file
                <input type="file" id="csv-upload" accept=".csv" style="display:none" />
            </label>
            <div class="upload-options" onclick="event.stopPropagation()">
                <input type="checkbox" id="exclude-bots" checked>
                <label for="exclude-bots">Exclude bots (names with #XXXX)</label>
            </div>
            <p class="upload-note">All processing happens in your browser. Nothing is uploaded.</p>
        </div>

        <!-- Dashboard -->
        <div id="dashboard" class="dashboard">

            <!-- Date Filter -->
            <div class="filter-bar">
                <span class="filter-label">Filter by date</span>
                <div class="filter-group">
                    <label for="filter-after">After</label>
                    <input type="date" id="filter-after">
                </div>
                <div class="filter-group">
                    <label for="filter-before">Before</label>
                    <input type="date" id="filter-before">
                </div>
                <button class="filter-reset" id="filter-reset">Reset</button>
                <span class="filter-count" id="filter-count"></span>
            </div>

            <!-- Overview Stats -->
            <div class="section-title">Overview</div>
            <div class="stats-grid" id="stats-overview"></div>

            <!-- Per-User Breakdown -->
            <div class="section-title">Per-User Breakdown</div>
            <div class="user-table-wrap">
                <table class="user-table" id="user-table">
                    <thead><tr>
                        <th data-sort="name">User</th>
                        <th data-sort="msgs" class="sort-desc">Messages</th>
                        <th data-sort="share">Share</th>
                        <th data-sort="words">Avg Words</th>
                        <th data-sort="resp">Response Time</th>
                        <th data-sort="starts">Starts</th>
                        <th data-sort="media">Media</th>
                        <th data-sort="emojis">Emojis</th>
                        <th data-sort="calls">Calls</th>
                        <th data-sort="calltime">Call Time</th>
                    </tr></thead>
                    <tbody id="user-table-body"></tbody>
                </table>
            </div>

            <!-- Charts -->
            <div class="section-title">Charts</div>
            <div class="charts-grid">
                <div class="chart-card">
                    <div class="chart-title">Message Distribution</div>
                    <div class="chart-container"><canvas id="pieChart"></canvas></div>
                </div>
                <div class="chart-card">
                    <div class="chart-title">Who Texts First?</div>
                    <div class="chart-desc">After gaps longer than 1 hour</div>
                    <div class="chart-container"><canvas id="startersChart"></canvas></div>
                </div>

                <div class="chart-card">
                    <div class="chart-title">Double Texting Rate</div>
                    <div class="chart-desc">Average consecutive messages before a reply</div>
                    <div class="chart-container"><canvas id="doubleTextChart"></canvas></div>
                </div>
                <div class="chart-card">
                    <div class="chart-title">Response Time</div>
                    <div class="chart-desc">Average reply time in minutes</div>
                    <div class="chart-container"><canvas id="responseTimeChart"></canvas></div>
                </div>

                <div class="chart-card">
                    <div class="chart-title">Message Length</div>
                    <div class="chart-desc">Average vs median word count per message</div>
                    <div class="chart-container"><canvas id="msgLengthChart"></canvas></div>
                </div>
                <div class="chart-card">
                    <div class="chart-title">Media &amp; Links</div>
                    <div class="chart-desc">Attachments and URLs shared</div>
                    <div class="chart-container"><canvas id="mediaChart"></canvas></div>
                </div>

                <div class="chart-card">
                    <div class="chart-title">Top Words</div>
                    <div class="chart-container"><canvas id="wordsChart"></canvas></div>
                </div>
                <div class="chart-card">
                    <div class="chart-title">Time of Day</div>
                    <div class="chart-desc">Distribution across 4 time blocks</div>
                    <div class="chart-container"><canvas id="timePeriodChart"></canvas></div>
                </div>

                <div class="chart-card full-width">
                    <div class="chart-title">Activity by Day of Week</div>
                    <div class="chart-container"><canvas id="dayOfWeekChart"></canvas></div>
                </div>

                <div class="chart-card full-width">
                    <div class="chart-title">Activity Over Time</div>
                    <div class="chart-container tall"><canvas id="timelineChart"></canvas></div>
                </div>

                <div class="chart-card full-width">
                    <div class="chart-title">Hourly Activity</div>
                    <div class="chart-container"><canvas id="timeOfDayChart"></canvas></div>
                </div>

                <div class="chart-card full-width">
                    <div class="chart-title">Top Custom Emojis</div>
                    <div class="chart-container"><canvas id="emojiChart"></canvas></div>
                </div>
            </div>

            <!-- Activity Heatmap -->
            <div class="section-title">Activity Heatmap</div>
            <div class="heatmap-wrap">
                <div class="heatmap-grid" id="heatmap-grid"></div>
                <div class="heatmap-legend" id="heatmap-legend"></div>
            </div>

            <!-- Reaction Analysis -->
            <div id="reactions-section" class="hidden">
                <div class="section-title">Reaction Analysis</div>
                <div class="stats-grid" id="stats-reactions"></div>
                <div class="reaction-highlight" id="most-reacted-msg"></div>
                <div class="charts-grid" style="margin-top:12px">
                    <div class="chart-card">
                        <div class="chart-title">Top Reactions</div>
                        <div class="chart-container"><canvas id="topReactionsChart"></canvas></div>
                    </div>
                    <div class="chart-card">
                        <div class="chart-title">Most Reacted Users</div>
                        <div class="chart-desc">Who gets the most reactions on their messages</div>
                        <div class="chart-container"><canvas id="reactedUsersChart"></canvas></div>
                    </div>
                </div>
            </div>

            <!-- Call Analytics -->
            <div id="calls-section" class="hidden">
                <div class="section-title">Call Analytics</div>
                <div class="stats-grid" id="stats-calls"></div>

                <div class="charts-grid" style="margin-top:12px">
                    <div class="chart-card">
                        <div class="chart-title">Who Initiates Calls?</div>
                        <div class="chart-container"><canvas id="callInitiatorChart"></canvas></div>
                    </div>
                    <div class="chart-card">
                        <div class="chart-title">Call Duration Distribution</div>
                        <div class="chart-desc">Number of calls grouped by duration</div>
                        <div class="chart-container"><canvas id="callDurationDistChart"></canvas></div>
                    </div>
                    <div class="chart-card full-width">
                        <div class="chart-title">Call Duration Over Time</div>
                        <div class="chart-desc">Each point is a call, sized by duration</div>
                        <div class="chart-container tall"><canvas id="callTimelineChart"></canvas></div>
                    </div>
                    <div class="chart-card full-width">
                        <div class="chart-title">Calls by Day of Week</div>
                        <div class="chart-container"><canvas id="callDayOfWeekChart"></canvas></div>
                    </div>
                </div>
            </div>

            <div class="footer">
                <button onclick="location.reload()">Analyze a different file</button>
            </div>
        </div>

    </div>

    <script src="app.js"></script>
</body>
</html>